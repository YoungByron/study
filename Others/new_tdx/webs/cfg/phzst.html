<!DOCTYPE html><html><head><meta charset="utf-8"><title>盘后交易分时图</title><style>*{margin:0;padding:0}body,html{overflow:hidden;border:none;font-family:微软雅黑;font-size:14px}body.black{background:#000;color:#fff}body.white{background:#fff;color:#000}#gErr{position:fixed;left:0;top:0;right:0;bottom:0;text-align:center;line-height:270px;z-index:10000;color:#999;display:none}#price{color:#999;position:fixed;left:10px;top:2px;font-size:12px;z-index:1000000}</style></head><body scroll="no"><div id="app"></div><span id="price"></span><div id="gErr">没有数据</div><script src="../jquery-1.7.2.min.js"></script><script src="../js/echarts.js"></script><script>var isIE=!0;isIE=!!(window.ActiveXObject||"ActiveXObject"in window),Array.prototype.filter||(Array.prototype.filter=function(t){if(null==this)throw new TypeError;var e=Object(this),a=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=[],o=2<=arguments.length?arguments[1]:void 0,i=0;i<a;i++)if(i in e){var n=e[i];t.call(o,n,i,e)&&r.push(n)}return r}),Array.prototype.map||(Array.prototype.map=function(t,e){var a,r,o;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),n=i.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(e&&(a=e),r=new Array(n),o=0;o<n;){var l,m;o in i&&(l=i[o],m=t.call(a,l,o,i),r[o]=m),o++}return r});var f_callpc=function(t,o){var e={Method:t.Method||"ASK_PHFBBData",FuncName:t.FuncName||"",Param:t.Param||""};if(isIE){if("ASK_PHFBBData"==e.Method)window.SetZSTData=function(t,e){o(null,e)},window.external.ASK_PHFBBData(g_iNo,e.Param);else if("SYS_FUNCData"==e.Method){var a,r;if(window.SetSYSData=function(t,e,a,r){o(null,r)},/^[0-9]+\|.*/.test(e.Param)){var i=e.Param.split("|");a=1*i[0],r=e.Param.substr(i[0].length+1),window.external.SYS_FUNCData(a,r)}else window.external.SYS_FUNCData(e.Param)}}else{var n=JSON.stringify(e);o=o||function(){},window.TDXQuery({request:n,onSuccess:function(t){o(null,t)},onFailure:function(t,e){o(t,e)}})}},f_getparam=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(e);return null!=a?decodeURIComponent(a[2]):null},$gApp=$("#app"),gApp=$gApp[0],$gWin=$(window),gWidth=$gWin.width(),gHeight=$gWin.height(),gMarket=f_getparam("setcode"),gCode=f_getparam("code"),gDays=f_getparam("daynum"),gStyle=f_getparam("color")||0,gBkColor=f_getparam("bkcolor"),g_iNo=99,gInterval=5e3;document.body.className=1==gStyle?"white":"black";var blackColor="#000",whiteColor="#fff",grayColor="#ccc",yellowColor="yellow",blackColor2="#5A5A5A",redColor="#f00",grayColor2="#666",backColor3="#333";/^[a-z0-9]{6}$/i.test(gBkColor)&&(document.body.style.backgroundColor="#"+gBkColor),$gApp.width(gWidth),$gApp.height(gHeight);var gList=[],gMaxY=0,gNums=0,gZbs=0;function draw(t,e,a,r){var o=echarts.init(gApp);$("#price").html(t[t.length-1]+" 成交价: "+r.max_z.toFixed(2));var i=[];0<gNums&&i.push("分笔数: "+gNums),0<gZbs&&i.push("逐笔数: "+gZbs),o.setOption({title:{x:"right",y:"top",textStyle:{fontSize:12,fontWeight:"normal",color:"#999"},text:i.join("  ")},animation:!1,tooltip:{trigger:"axis"},grid:{top:30,right:20,left:45,bottom:24,backgroundColor:"#ff0000"},legend:{data:["成交量"],show:!1},xAxis:{data:t,axisLabel:{color:grayColor2,showMaxLabel:!0}},yAxis:{axisLabel:{color:grayColor2,formatter:function(t,e){return f_format(1*t)}},splitLine:{show:!0,lineStyle:{color:[backColor3],width:1,type:"solid"}}},series:[{name:"成交量",type:"bar",data:e,barWidth:1}],color:[0==gStyle?yellowColor:blackColor2],textStyle:{color:0==gStyle?whiteColor:blackColor}},!0)}f_render_data=function(){var a={},r={};gList.map(function(t,e){0==e&&(r.min_x=t.timeInt,r.min_y=t.vol,r.min_z=t.price,r.max_x=t.timeInt,r.max_y=t.vol,r.max_z=t.price),a[t.timeInt]=t,r.min_x=Math.min(t.timeInt,r.min_x),r.max_x=Math.max(t.timeInt,r.max_x),r.min_y=Math.min(t.vol,r.min_y),r.max_y=Math.max(t.vol,r.max_y),r.min_z=Math.min(t.price,r.min_z),r.max_z=Math.max(t.price,r.max_z)});for(var t,e,o=r.min_x,i=r.max_x,n=[],l=[],m=[],g=o;g<=i;g++)a[g]?(t=a[g].vol,e=a[g].price):t=null,n.push(f_fmt_time(g)),l.push(t),m.push(e);0<n.length&&draw(n,l,m,r)},f_format=function(t){if("string"==typeof t&&(t=1*t.replace(/\,/g,"")),1e3<=t){var e=(t/1e3).toFixed(2)+"";return-1!=e.indexOf(".")&&(e=e.replace(/[0]*$/,"").replace(/\.$/,"")),e+"K"}return t},f_fmt_time=function(t){return(100+Math.floor(t/60)).toString().substr(1)+":"+(100+t%60).toString().substr(1)},f_request=function(){gZbs=gNums=0,f_callpc({Param:g_iNo+"|"+gMarket+gCode},function(t,r){if(null==t)if(null!=r&&/\[.+\]/.test(r)){r=r.replace(/(\[|\])/g,"").split("|");var o=[];r.map(function(t,e){var a=t.split(",");r[e]={time:1*a[0],price:1*a[1],vol:1*a[2],zbs:1*a[3]},gNums++,gZbs+=r[e].zbs,0<e&&r[e-1].time===r[e].time?(r[e].vol+=r[e-1].vol,o[o.length-1]=r[e]):o.push(r[e])}),o.map(function(t){t.timeInt=t.time,t.time=f_fmt_time(t.time)}),gList=o,f_render_data()}else $("#gErr").html("很抱歉，暂时没有数据！").show()})},f_request();var lastTimeStamp=-1;setInterval(function(){var t=$(window).width();t<64||f_callpc({Method:"SYS_FUNCData",Param:"28|"+gMarket+gCode},function(t,e){if(/^\[[0-9]+\]$/.test(e)){var a=1*e.replace(/(\[|\])/g,"");0<1*a&&a!=lastTimeStamp&&(-1!=lastTimeStamp&&f_request(),lastTimeStamp=a)}})},gInterval)</script></body></html>